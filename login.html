<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Giriş Yap | ASÜ Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">

    <div class="bg-gray-800 p-8 rounded shadow-lg w-96 border-t-4 border-red-600">
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-white">ASÜ <span class="text-red-600">HUB</span></h1>
            <p class="text-gray-400 text-sm">Öğrenci Girişi</p>
        </div>

        <div class="flex mb-4">
            <button onclick="showLogin()" id="tabLogin" class="flex-1 py-2 bg-red-600 text-white font-bold text-sm">GİRİŞ</button>
            <button onclick="showRegister()" id="tabRegister" class="flex-1 py-2 bg-gray-700 text-gray-300 font-bold text-sm hover:bg-gray-600">KAYIT OL</button>
        </div>

        <form id="loginForm" class="space-y-4">
            <input type="email" id="loginEmail" placeholder="E-posta Adresi" class="w-full bg-gray-700 border border-gray-600 p-3 rounded text-white outline-none focus:border-red-500">
            <input type="password" id="loginPass" placeholder="Şifre" class="w-full bg-gray-700 border border-gray-600 p-3 rounded text-white outline-none focus:border-red-500">
            <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded transition">GİRİŞ YAP</button>
        </form>

        <form id="registerForm" class="space-y-4 hidden">
            <input type="email" id="regEmail" placeholder="Okul E-postası" class="w-full bg-gray-700 border border-gray-600 p-3 rounded text-white outline-none focus:border-red-500">
            <input type="password" id="regPass" placeholder="Şifre Belirle" class="w-full bg-gray-700 border border-gray-600 p-3 rounded text-white outline-none focus:border-red-500">
            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded transition">KAYIT OL</button>
        </form>
    </div>

    <script>
        // YENİ ANAHTAR EKLENDİ
        const SUPABASE_URL = "https://kmzbywrcspzwuznexcla.supabase.co";
        const SUPABASE_KEY = "sb_publishable_z2fcMIygDFlXaZD3z1CxbA_YkPXzxNt";
        const asuDb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function showLogin(){
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('tabLogin').className = "flex-1 py-2 bg-red-600 text-white font-bold text-sm";
            document.getElementById('tabRegister').className = "flex-1 py-2 bg-gray-700 text-gray-300 font-bold text-sm hover:bg-gray-600";
        }
        function showRegister(){
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('tabLogin').className = "flex-1 py-2 bg-gray-700 text-gray-300 font-bold text-sm hover:bg-gray-600";
            document.getElementById('tabRegister').className = "flex-1 py-2 bg-green-600 text-white font-bold text-sm";
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;
            
            if(email === 'admin' && password === 'asu123') { localStorage.setItem('isAdmin', 'true'); window.location.href = 'admin.html'; return; }
            
            const { error } = await asuDb.auth.signInWithPassword({ email, password });
            if (error) alert("Hata: " + error.message);
            else { 
                const { data } = await asuDb.from('profiles').select('*').eq('email', email).single();
                if(data && data.is_banned) return alert("Yasaklandınız!");
                localStorage.setItem('userEmail', email); window.location.href = 'index.html'; 
            }
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPass').value;
            const { error } = await asuDb.auth.signUp({ email, password });
            if (error) alert("Hata: " + error.message);
            else { await asuDb.from('profiles').insert([{ email: email }]); alert("Kayıt başarılı! Giriş yapabilirsin."); showLogin(); }
        });
    </script>
</body>
</html>
