<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>ASÃœ Sahaf</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>tailwind.config = { theme: { extend: { colors: { asuPrimary: '#e11d48', asuDark: '#0f172a' } } } }</script>
</head>
<body class="bg-gray-50 min-h-screen">
    <nav class="bg-white shadow p-4 mb-6">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="index.html" class="font-bold text-xl">ASÃœ SAHAF</a>
            <button onclick="openModal()" class="bg-green-600 text-white px-4 py-2 rounded font-bold">+ Ä°lan Ver</button>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
        <div class="md:col-span-1 space-y-2">
            <h3 class="font-bold text-gray-800 mb-2">Kategoriler</h3>
            <button onclick="filter('TÃ¼mÃ¼')" class="w-full text-left p-3 bg-white rounded shadow hover:bg-gray-50">TÃ¼mÃ¼</button>
            <button onclick="filter('SatÄ±lÄ±k')" class="w-full text-left p-3 bg-white rounded shadow hover:bg-gray-50 border-l-4 border-green-500">ğŸ’° SatÄ±lÄ±k</button>
            <button onclick="filter('Takas')" class="w-full text-left p-3 bg-white rounded shadow hover:bg-gray-50 border-l-4 border-blue-500">ğŸ”„ TakaslÄ±k</button>
            <button onclick="filter('BaÄŸÄ±ÅŸ')" class="w-full text-left p-3 bg-white rounded shadow hover:bg-gray-50 border-l-4 border-purple-500">ğŸ BaÄŸÄ±ÅŸ</button>
        </div>

        <div class="md:col-span-3">
            <h2 class="text-2xl font-bold mb-4">Kitap Vitrini</h2>
            <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">YÃ¼kleniyor...</div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center p-4">
        <div class="bg-white p-6 rounded-xl w-full max-w-md">
            <h2 class="text-xl font-bold mb-4">Yeni Ä°lan</h2>
            <form id="form" class="space-y-3">
                <input type="file" id="img" class="text-sm" required>
                <input type="text" id="title" placeholder="Kitap AdÄ±" class="w-full p-2 border rounded" required>
                <select id="type" class="w-full p-2 border rounded">
                    <option value="SatÄ±lÄ±k">SatÄ±lÄ±k</option>
                    <option value="Takas">Takas</option>
                    <option value="BaÄŸÄ±ÅŸ">BaÄŸÄ±ÅŸ</option>
                </select>
                <input type="text" id="price" placeholder="Fiyat (BaÄŸÄ±ÅŸ ise boÅŸ bÄ±rak)" class="w-full p-2 border rounded">
                <input type="text" id="contact" placeholder="Tel No (WhatsApp)" class="w-full p-2 border rounded" required>
                <button type="submit" class="w-full bg-green-600 text-white py-2 rounded font-bold">YayÄ±nla</button>
                <button type="button" onclick="document.getElementById('modal').classList.add('hidden')" class="w-full mt-2 text-gray-500">Ä°ptal</button>
            </form>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://kmzbywrcspzwuznexcla.supabase.co";
        const SUPABASE_KEY = "sb_publishable_z2fcMIygDFlXaZD3z1CxbA_YkPXzxNt";
        const asuDb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let all = [];

        async function load() {
            const { data } = await asuDb.from('books').select('*').eq('is_approved', true);
            if(data) { all = data; render(all); }
        }

        function render(list) {
            document.getElementById('grid').innerHTML = list.map(b => `
                <div class="bg-white rounded-xl shadow overflow-hidden group">
                    <img src="${b.image_url}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <span class="text-xs font-bold px-2 py-1 rounded ${b.type==='SatÄ±lÄ±k'?'bg-green-100 text-green-700':(b.type==='BaÄŸÄ±ÅŸ'?'bg-purple-100 text-purple-700':'bg-blue-100 text-blue-700')}">${b.type}</span>
                        <h3 class="font-bold mt-2 truncate">${b.title}</h3>
                        <p class="text-lg font-bold text-gray-800 my-2">${b.type==='SatÄ±lÄ±k' ? b.price + ' TL' : (b.type==='Takas' ? 'ğŸ”„ Takas' : 'Ãœcretsiz')}</p>
                        <a href="https://wa.me/90${b.contact.replace(/[^0-9]/g,'')}" target="_blank" class="block w-full text-center bg-green-600 text-white py-2 rounded text-sm font-bold"><i class="fa-brands fa-whatsapp"></i> Ä°letiÅŸime GeÃ§</a>
                    </div>
                </div>
            `).join('');
        }

        function filter(type) {
            render(type === 'TÃ¼mÃ¼' ? all : all.filter(b => b.type === type));
        }

        function openModal() {
            if(!localStorage.getItem('userEmail')) return alert("GiriÅŸ yap!");
            document.getElementById('modal').classList.remove('hidden');
        }

        document.getElementById('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const f = document.getElementById('img').files[0];
            const name = Date.now() + "_" + f.name.replace(/[^a-zA-Z0-9.]/g,'');
            const {data:u} = await asuDb.storage.from('kitap-fotolari').upload(name, f);
            const {data:p} = asuDb.storage.from('kitap-fotolari').getPublicUrl(name);
            await asuDb.from('books').insert([{
                title: document.getElementById('title').value,
                price: document.getElementById('price').value || "0",
                contact: document.getElementById('contact').value,
                image_url: p.publicUrl,
                type: document.getElementById('type').value,
                seller_email: localStorage.getItem('userEmail')
            }]);
            alert("Ä°lan gÃ¶nderildi! Admin onaylayÄ±nca yayÄ±nda."); location.reload();
        });
        load();
    </script>
</body>
</html>
