<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Profil | ASÜ Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <nav class="bg-red-600 p-4 flex justify-between items-center">
        <a href="index.html" class="font-bold text-xl">ASÜ HUB</a>
        <button onclick="logout()" class="bg-gray-800 px-4 py-2 rounded font-bold text-sm">ÇIKIŞ</button>
    </nav>

    <div class="max-w-2xl mx-auto p-8">
        <div class="bg-gray-800 p-6 rounded border border-gray-700 text-center mb-8">
            <div class="w-24 h-24 bg-red-600 rounded-full mx-auto flex items-center justify-center text-4xl font-bold mb-4" id="avatar">..</div>
            <h1 class="text-2xl font-bold" id="email">...</h1>
            <p class="text-gray-400">Öğrenci Profili</p>
        </div>

        <div class="grid grid-cols-2 gap-8">
            <div class="bg-gray-800 p-6 rounded border border-gray-700">
                <h3 class="font-bold border-b border-gray-600 pb-2 mb-4">Notlarım</h3>
                <div id="notes" class="text-sm space-y-2">Yükleniyor...</div>
            </div>
            <div class="bg-gray-800 p-6 rounded border border-gray-700">
                <h3 class="font-bold border-b border-gray-600 pb-2 mb-4">Kitaplarım</h3>
                <div id="books" class="text-sm space-y-2">Yükleniyor...</div>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://kmzbywrcspzwuznexcla.supabase.co";
        const SUPABASE_KEY = "sb_publishable_z2fcMIygDFlXaZD3z1CxbA_YkPXzxNt";
        const asuDb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const email = localStorage.getItem('userEmail');

        if(!email) window.location.href='login.html';
        document.getElementById('email').innerText = email;
        document.getElementById('avatar').innerText = email.substring(0,2).toUpperCase();

        async function load() {
            const { data: n } = await asuDb.from('notes').select('*').eq('uploader_email', email);
            document.getElementById('notes').innerHTML = n.length ? n.map(x=>`<div class="flex justify-between"><span>${x.title}</span><button onclick="del('notes',${x.id})" class="text-red-500">Sil</button></div>`).join('') : 'Not yok.';
            
            const { data: b } = await asuDb.from('books').select('*').eq('seller_email', email);
            document.getElementById('books').innerHTML = b.length ? b.map(x=>`<div class="flex justify-between"><span>${x.title}</span><button onclick="del('books',${x.id})" class="text-red-500">Sil</button></div>`).join('') : 'Kitap yok.';
        }
        async function del(t,id){ if(confirm('Sil?')) { await asuDb.from(t).delete().eq('id',id); load(); } }
        function logout(){ localStorage.clear(); window.location.href='index.html'; }
        load();
    </script>
</body>
</html>
