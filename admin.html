<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÃ¶netici Paneli - ASÃœ Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = { theme: { extend: { colors: { asuDark: '#0f172a', asuCard: '#1e293b', asuPurple: '#6366f1', asuRed: '#ef4444' } } } }
    </script>
</head>
<body class="bg-[#0f172a] min-h-screen text-slate-200 font-sans">

    <nav class="bg-asuRed border-b border-red-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <div class="bg-white text-red-600 rounded-full w-8 h-8 flex items-center justify-center font-bold"><i class="fa-solid fa-lock"></i></div>
                    <span class="font-bold text-xl text-white tracking-tight">ADMIN PANELÄ°</span>
                </div>
                <div class="flex items-center gap-4">
                    <a href="index.html" class="text-white hover:text-slate-200 text-sm"><i class="fa-solid fa-eye"></i> Siteyi GÃ¶r</a>
                    <button onclick="adminLogout()" class="bg-white text-red-600 px-4 py-1.5 rounded-full text-sm font-bold hover:bg-slate-100 transition-colors">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-8">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="bg-asuCard border border-slate-700 p-6 rounded-xl flex items-center justify-between">
                <div>
                    <p class="text-slate-400 text-sm">Toplam Not</p>
                    <h3 class="text-3xl font-bold text-white" id="totalNotes">-</h3>
                </div>
                <div class="bg-indigo-500/20 p-4 rounded-lg text-indigo-400"><i class="fa-solid fa-file-pdf text-2xl"></i></div>
            </div>
            <div class="bg-asuCard border border-slate-700 p-6 rounded-xl flex items-center justify-between">
                <div>
                    <p class="text-slate-400 text-sm">SatÄ±lÄ±k Kitap</p>
                    <h3 class="text-3xl font-bold text-white" id="totalBooks">-</h3>
                </div>
                <div class="bg-emerald-500/20 p-4 rounded-lg text-emerald-400"><i class="fa-solid fa-book text-2xl"></i></div>
            </div>
            <div class="bg-asuCard border border-slate-700 p-6 rounded-xl flex items-center justify-between">
                <div>
                    <p class="text-slate-400 text-sm">Durum</p>
                    <h3 class="text-xl font-bold text-green-400">Aktif ðŸŸ¢</h3>
                </div>
                <div class="bg-slate-700 p-4 rounded-lg text-slate-400"><i class="fa-solid fa-server text-2xl"></i></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <div class="bg-asuCard border border-slate-700 rounded-xl overflow-hidden">
                <div class="bg-slate-800 px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                    <h3 class="font-bold text-white"><i class="fa-solid fa-file-lines mr-2"></i>NotlarÄ± YÃ¶net</h3>
                    <button onclick="loadData()" class="text-xs text-asuPurple hover:text-white"><i class="fa-solid fa-rotate"></i> Yenile</button>
                </div>
                <div class="p-4 h-96 overflow-y-auto" id="notesList">
                    <div class="text-center text-slate-500 mt-10">YÃ¼kleniyor...</div>
                </div>
            </div>

            <div class="bg-asuCard border border-slate-700 rounded-xl overflow-hidden">
                <div class="bg-slate-800 px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                    <h3 class="font-bold text-white"><i class="fa-solid fa-store mr-2"></i>KitaplarÄ± YÃ¶net</h3>
                    <button onclick="loadData()" class="text-xs text-asuPurple hover:text-white"><i class="fa-solid fa-rotate"></i> Yenile</button>
                </div>
                <div class="p-4 h-96 overflow-y-auto" id="booksList">
                    <div class="text-center text-slate-500 mt-10">YÃ¼kleniyor...</div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- SUPABASE BAÄžLANTISI ---
        const SUPABASE_URL = "https://kmzbywrcspzwuznexcla.supabase.co";
        const SUPABASE_KEY = "sb_publishable_2mPJ390ssxg8euZ9hgmfFg_O5mPR1Fh"; 
        const { createClient } = window.supabase;
        const asuDb = createClient(SUPABASE_URL, SUPABASE_KEY);

        // 1. GÃœVENLÄ°K KONTROLÃœ (Admin DeÄŸilse Kov)
        if (localStorage.getItem('isAdmin') !== 'true') {
            alert("Buraya giriÅŸ yetkiniz yok!");
            window.location.href = 'login.html';
        }

        // 2. Ã‡IKIÅž YAP
        function adminLogout() {
            localStorage.removeItem('isAdmin');
            window.location.href = 'index.html';
        }

        // 3. SÄ°LME Ä°ÅžLEMÄ°
        async function deleteItem(table, id) {
            if(!confirm("YÃ–NETÄ°CÄ° DÄ°KKAT: Bu iÃ§eriÄŸi kalÄ±cÄ± olarak silmek Ã¼zeresin. OnaylÄ±yor musun?")) return;

            try {
                const { error } = await asuDb.from(table).delete().eq('id', id);
                if(error) throw error;
                
                // Listeyi o an gÃ¼ncelle (sayfayÄ± yenilemeden)
                document.getElementById(`${table}-${id}`).remove();
                
                // SayacÄ± gÃ¼ncelle
                const countElem = table === 'notes' ? 'totalNotes' : 'totalBooks';
                const currentCount = parseInt(document.getElementById(countElem).innerText);
                document.getElementById(countElem).innerText = currentCount - 1;

            } catch (error) {
                alert("Silme hatasÄ±: " + error.message);
            }
        }

        // 4. VERÄ°LERÄ° GETÄ°R
        async function loadData() {
            // A) NotlarÄ± Getir
            const { data: notes, error: nError } = await asuDb.from('notes').select('*').order('created_at', { ascending: false });
            
            if(notes) {
                document.getElementById('totalNotes').innerText = notes.length;
                const notesContainer = document.getElementById('notesList');
                
                if(notes.length === 0) notesContainer.innerHTML = '<div class="text-center text-slate-500 py-10">HiÃ§ not yok.</div>';
                else {
                    notesContainer.innerHTML = notes.map(note => `
                        <div id="notes-${note.id}" class="bg-slate-900 border border-slate-700 p-3 rounded-lg mb-3 flex items-center justify-between group hover:border-slate-500 transition-colors">
                            <div class="overflow-hidden">
                                <h4 class="font-bold text-white text-sm truncate"><a href="${note.file_url}" target="_blank" class="hover:underline">${note.title}</a></h4>
                                <p class="text-xs text-slate-500">YÃ¼kleyen: ${note.uploader_email}</p>
                            </div>
                            <button onclick="deleteItem('notes', ${note.id})" class="bg-red-900/30 text-red-500 hover:bg-red-600 hover:text-white p-2 rounded transition-colors text-xs ml-2">
                                <i class="fa-solid fa-trash"></i> Sil
                            </button>
                        </div>
                    `).join('');
                }
            }

            // B) KitaplarÄ± Getir
            const { data: books, error: bError } = await asuDb.from('books').select('*').order('created_at', { ascending: false });
            
            if(books) {
                document.getElementById('totalBooks').innerText = books.length;
                const booksContainer = document.getElementById('booksList');
                
                if(books.length === 0) booksContainer.innerHTML = '<div class="text-center text-slate-500 py-10">HiÃ§ kitap yok.</div>';
                else {
                    booksContainer.innerHTML = books.map(book => `
                        <div id="books-${book.id}" class="bg-slate-900 border border-slate-700 p-3 rounded-lg mb-3 flex items-center justify-between group hover:border-slate-500 transition-colors">
                            <div class="flex items-center gap-3 overflow-hidden">
                                <img src="${book.image_url}" class="w-8 h-8 rounded object-cover border border-slate-600">
                                <div>
                                    <h4 class="font-bold text-white text-sm truncate">${book.title}</h4>
                                    <p class="text-xs text-slate-500">SatÄ±cÄ±: ${book.seller_email}</p>
                                </div>
                            </div>
                            <button onclick="deleteItem('books', ${book.id})" class="bg-red-900/30 text-red-500 hover:bg-red-600 hover:text-white p-2 rounded transition-colors text-xs ml-2">
                                <i class="fa-solid fa-trash"></i> Sil
                            </button>
                        </div>
                    `).join('');
                }
            }
        }

        // BaÅŸlat
        loadData();
    </script>
</body>
</html>
