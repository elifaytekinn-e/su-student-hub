<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASÃœ Student Hub - Ã–ÄŸrenci AÄŸÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = { theme: { extend: { colors: { asuDark: '#0f172a', asuCard: '#1e293b', asuPurple: '#6366f1', asuGreen: '#10b981' }, fontFamily: { sans: ['Inter', 'sans-serif'] } } } }
    </script>
    <style>
        .gradient-text { background: linear-gradient(to right, #6366f1, #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero-bg { background-image: radial-gradient(circle at top right, #1e293b 0%, #0f172a 60%); }
    </style>
</head>
<body class="bg-asuDark min-h-screen text-slate-200 font-sans hero-bg">

    <nav class="bg-asuCard/80 backdrop-blur-md border-b border-slate-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <img src="asu_logo.png" alt="Logo" class="h-10 w-10 drop-shadow-lg">
                    <span class="font-bold text-xl text-white tracking-tight">ASÃœ Hub</span>
                </div>
                <div class="flex items-center gap-6">
                    <div class="hidden md:flex gap-6 text-sm font-medium">
                        <a href="notes.html" class="hover:text-asuPurple transition-colors">Ders NotlarÄ±</a>
                        <a href="books.html" class="hover:text-asuGreen transition-colors">Ä°kinci El</a>
                    </div>
                    
                    <div id="authButtons">
                        <a href="login.html" class="bg-asuPurple hover:bg-indigo-600 text-white px-5 py-2 rounded-full text-sm font-bold transition-all shadow-lg shadow-indigo-500/30">GiriÅŸ Yap</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="relative overflow-hidden pt-16 pb-12 text-center px-4">
        <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-6">
            Ã–ÄŸrenci AÄŸÄ±na <span class="gradient-text">HoÅŸ Geldin!</span> ğŸš€
        </h1>
        <p class="text-lg text-slate-400 max-w-2xl mx-auto mb-8">
            Ders notlarÄ±nÄ± paylaÅŸ, ikinci el kitaplarÄ±nÄ± sat, kampÃ¼sle baÄŸlantÄ±da kal. 
            BurasÄ± Aksaray Ãœniversitesi Ã¶ÄŸrencilerinin buluÅŸma noktasÄ±.
        </p>
        <div class="flex justify-center gap-4">
            <a href="notes.html" class="bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl border border-slate-600 transition-all flex items-center gap-2">
                <i class="fa-solid fa-file-pdf text-asuPurple"></i> Not Bul
            </a>
            <a href="books.html" class="bg-slate-800 hover:bg-slate-700 text-white px-6 py-3 rounded-xl border border-slate-600 transition-all flex items-center gap-2">
                <i class="fa-solid fa-book text-asuGreen"></i> Kitap Al/Sat
            </a>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-12 space-y-16">
        
        <section>
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                    <span class="bg-asuPurple/20 text-asuPurple p-2 rounded-lg"><i class="fa-solid fa-clock"></i></span>
                    Son Eklenen Notlar
                </h2>
                <a href="notes.html" class="text-sm text-slate-400 hover:text-white">TÃ¼mÃ¼ <i class="fa-solid fa-arrow-right ml-1"></i></a>
            </div>
            
            <div id="latestNotes" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="col-span-full text-center py-10"><i class="fa-solid fa-spinner fa-spin text-2xl text-slate-600"></i></div>
            </div>
        </section>

        <section>
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-white flex items-center gap-2">
                    <span class="bg-asuGreen/20 text-asuGreen p-2 rounded-lg"><i class="fa-solid fa-tag"></i></span>
                    Vitrin (SatÄ±lÄ±k Kitaplar)
                </h2>
                <a href="books.html" class="text-sm text-slate-400 hover:text-white">TÃ¼mÃ¼ <i class="fa-solid fa-arrow-right ml-1"></i></a>
            </div>
            
            <div id="latestBooks" class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="col-span-full text-center py-10"><i class="fa-solid fa-spinner fa-spin text-2xl text-slate-600"></i></div>
            </div>
        </section>

    </div>

    <footer class="border-t border-slate-800 mt-12 py-8 text-center text-slate-500 text-sm">
        <p>&copy; 2025 ASÃœ Student Hub. Ã–ÄŸrenciler tarafÄ±ndan geliÅŸtirildi. â¤ï¸</p>
    </footer>

    <script>
        // --- SUPABASE BAÄLANTISI ---
        const SUPABASE_URL = "https://kmzbywrcspzwuznexcla.supabase.co";
        const SUPABASE_KEY = "sb_publishable_2mPJ390ssxg8euZ9hgmfFg_O5mPR1Fh"; 
        const { createClient } = window.supabase;
        const asuDb = createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- 1. GÄ°RÄ°Å KONTROLÃœ (Navbar'Ä± DÃ¼zenle) ---
        const userEmail = localStorage.getItem('userEmail');
        if (userEmail) {
            // KullanÄ±cÄ± giriÅŸ yapmÄ±ÅŸsa "Profilim" butonunu gÃ¶ster
            const username = userEmail.split('@')[0];
            document.getElementById('authButtons').innerHTML = `
                <a href="profile.html" class="flex items-center gap-2 bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-full border border-slate-600 transition-all">
                    <i class="fa-solid fa-user-circle text-asuPurple"></i> 
                    <span>${username}</span>
                </a>
            `;
        }

        // --- 2. VERÄ°LERÄ° Ã‡EK VE GÃ–STER ---
        async function loadDashboard() {
            // A) Son 3 Notu Ã‡ek
            const { data: notes } = await asuDb.from('notes').select('*').order('created_at', { ascending: false }).limit(3);
            
            const notesContainer = document.getElementById('latestNotes');
            if (notes && notes.length > 0) {
                notesContainer.innerHTML = notes.map(note => `
                    <div class="bg-asuCard border border-slate-700 p-5 rounded-xl hover:border-asuPurple transition-colors group cursor-pointer" onclick="window.location.href='${note.file_url}'">
                        <div class="flex items-center justify-between mb-3">
                            <i class="fa-solid fa-file-pdf text-2xl text-red-400"></i>
                            <span class="text-xs text-slate-500">${new Date(note.created_at).toLocaleDateString('tr-TR')}</span>
                        </div>
                        <h3 class="font-bold text-white group-hover:text-asuPurple truncate">${note.title}</h3>
                        <p class="text-sm text-slate-400 mt-1 truncate">${note.description || 'AÃ§Ä±klama yok'}</p>
                        <div class="mt-3 text-xs text-slate-500"><i class="fa-solid fa-user mr-1"></i> ${note.uploader_email.split('@')[0]}</div>
                    </div>
                `).join('');
            } else {
                notesContainer.innerHTML = '<div class="col-span-full text-slate-500 text-center">HenÃ¼z not paylaÅŸÄ±lmadÄ±.</div>';
            }

            // B) Son 4 KitabÄ± Ã‡ek
            const { data: books } = await asuDb.from('books').select('*').order('created_at', { ascending: false }).limit(4);
            
            const booksContainer = document.getElementById('latestBooks');
            if (books && books.length > 0) {
                booksContainer.innerHTML = books.map(book => `
                    <div class="bg-asuCard border border-slate-700 rounded-xl overflow-hidden group">
                        <div class="h-32 bg-slate-800 relative">
                            <img src="${book.image_url}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity">
                            <div class="absolute bottom-2 right-2 bg-green-600 text-white text-xs font-bold px-2 py-1 rounded shadow">${book.price}</div>
                        </div>
                        <div class="p-3">
                            <h3 class="font-bold text-white text-sm truncate">${book.title}</h3>
                            <a href="books.html" class="text-xs text-asuGreen hover:underline mt-2 block">Ä°ncele &rarr;</a>
                        </div>
                    </div>
                `).join('');
            } else {
                booksContainer.innerHTML = '<div class="col-span-full text-slate-500 text-center">HenÃ¼z satÄ±lÄ±k kitap yok.</div>';
            }
        }

        loadDashboard();
    </script>
</body>
</html>
